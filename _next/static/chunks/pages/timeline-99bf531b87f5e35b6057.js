_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[27],{"Dx8+":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return A}));var o=n("q1tI"),a=n.n(o),r=n("rePB"),c=n("B3wi"),s=n("PObt"),i=n("A9a1"),l=n("qg42"),m=n.n(l),u=n("uoqP"),d=n("tsqr"),p=a.a.createElement;function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var g={loading:!1,postingLoading:!1,timelineData:[]};function O(e,t){var n=t.type,o=t.payload;switch(n){case"timeline/SET_LOADING":return f(f({},e),{},{loading:o});case"timeline/SET_POSTING_LOADING":return f(f({},e),{},{postingLoading:o});case"timeline/SET_TIMELINE_DATA":return f(f({},e),{},{timelineData:o});default:return e}}var b=Object(o.createContext)([{},function(){}]),v=function(e){var t=e.children,n=Object(o.useReducer)(O,g);return p(b.Provider,{value:n},t)};function y(e){switch(e){case"timeline":return"timeline/SET_LOADING";case"posting":return"timeline/SET_POSTING_LOADING";default:return""}}var w=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"timeline";return{type:y(t),payload:e}},P=function(e){return{type:"timeline/SET_TIMELINE_DATA",payload:e}},j=n("FVaq"),D=n("jL+W"),E=n("rOC1"),C=n("ffwR"),S=a.a.createElement;function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var T=Object(D.a)((function({authServices:e,auth:t}){var n;const{0:r,1:l}=Object(o.useContext)(b),{0:p,1:h}=Object(o.useState)(!1),{0:f,1:g}=Object(o.useState)(!1),O=async(t,n=!1)=>{try{n||l(w(!0));const a=await Object(u.a)({method:"post",url:"/accounts/timeline",headers:{"x-token":t}}),{data:r,status:c}=a;if(200===c){var o=r.map(e=>e=v(e));l(P(o)),console.log("=========")}else 403===c?(console.log("================= Refresh token !"),e.refreshToken(O)):d.b.error((null===r||void 0===r?void 0:r.message)||"Something wrong");n||l(w(!1))}catch(a){console.log(a),n||l(w(!1))}},v=e=>"Comment"===e.type?"Post"==e.commented.type?k(k({},e.commented),{},{comments:[k(k({},e),{},{account:e.commented.account})]}):"Comment"==e.commented.type?k(k({},e.commented.commented),{},{comments:[k(k({},e.commented),{},{comments:[e],account:e.commented.commented.account})]}):"Share"==e.commented.type?k(k({},e.commented.shared),{},{comments:[k(k({},e),{},{account:e.commented.shared.account})]}):k(k({},e.commented),{},{comments:[k(k({},e),{},{account:e.commented.account})]}):"Post"===e.type?e:"Share"===e.type?k(k({},e.shared),{},{comments:[k(k({},e),{},{account:e.shared.account})]}):e,y=()=>{h(!0)};Object(o.useEffect)(()=>{O(t.token),window.addEventListener("scroll",_.throttle(()=>{const e=window.pageYOffset;g(e>100)},250))},[]);const{user:D}=t;return S(a.a.Fragment,null,S(c.a,null),S("div",{className:m.a.timeline},S("div",{className:m.a.feed_container},S("div",{className:m.a.createPostDiv},S(C.a,{size:50,url:null===D||void 0===D||null===(n=D.profilePhoto)||void 0===n?void 0:n.src}),S("input",{className:m.a.createPostInput,placeholder:"What's on your mind?",onClick:y})),S(j.a,{loading:r.loading},S(s.a,{data:r.timelineData,onUpdateTimeline:e=>{r.timelineData.map(n=>{if(n.id==e.id){let o=k({account:t.user},e.comments[0]);return n.comments.push(o),n.commentsCount+=e.commentsCount,n}}),console.log(r.timelineData),l(P(r.timelineData))},onRatePost:async(e,n,o)=>{try{l(w(!0,"posting"));let a="";"Photo"===e?a="/photos/rate":"VideoClip"===e?a="/video-clips/rate":"Item"===e?a="/items/rate":"Post"===e?a="/posts/rate":"Comment"===e&&(a="/comments/rate");const c=await Object(u.a)({method:"post",url:a,data:{id:n,rating:o},headers:{"x-token":t.token}}),{data:s,status:i}=c;return console.warn("ratePost",s,i),201===i?(r.timelineData.map(t=>{if(t.id===n&&t.type===e)return t.rating=o,t}),l(P(r.timelineData))):d.b.error((null===s||void 0===s?void 0:s.message)||"Something wrong"),l(w(!1,"posting")),await c}catch(a){l(w(!1,"posting"))}},likeAction:async(e,n,o)=>{var a="";"Photo"===e?a="/photos/react":"VideoClip"===e?a="/video-clips/react":"Item"===e?a="/items/react":"Post"===e?a="/posts/react":"Comment"===e?a="/comments/react":"Share"===e&&(a="/shares/react");try{const e=await Object(u.a)({method:"post",url:a,data:{reacted:n,reaction:o},headers:{"x-token":t.token}}),{data:r,status:c}=e;if(201!==c)throw d.b.error((null===r||void 0===r?void 0:r.message)||"Something wrong"),new Error;d.b.success("Added successfully")}catch(r){console.log(r)}},shareAction:async(e,n)=>{var o="";"Photo"===e?o="/photos/share":"VideoClip"===e?o="/video-clips/share":"Item"===e?o="/items/share":"Post"===e?o="/posts/share":"Comment"===e?o="/comments/share":"Share"===e&&(o="/posts/share");try{const e=await Object(u.a)({method:"post",url:o,data:{shared:n},headers:{"x-token":t.token}}),{data:a,status:r}=e;if(201!==r)throw d.b.error((null===a||void 0===a?void 0:a.message)||"Something wrong"),new Error;d.b.success("Shared successfully")}catch(a){console.log(a)}},deleteAction:async e=>{try{const o=await Object(u.a)({method:"delete",url:"/posts",data:{id:e},headers:{"x-token":t.token}}),{data:a,status:c}=o;if(400!==c){var n=r.timelineData.filter(t=>t.id!==e);l(P(n)),d.b.success("Deleted successfully!")}else d.b.error("This post deleting does not allowed!")}catch(o){console.log(o)}}})))),S(E.a,{title:"Create Post",showModal:p,onClose:()=>h(0)},S(i.a,{loading:r.postingLoading,onPosting:async e=>{try{l(w(!0,"posting"));const n=await Object(u.a)({method:"post",url:"/posts",data:e,headers:{"x-token":t.token}}),{data:o,status:a}=n;if(201===a){h(0);let e=[k(k({type:"Post"},o),{},{comments:[],commentsCount:0,rating:null,reactions:[],reactionsCount:0,shares:[],sharesCount:0,account:t.user}),...r.timelineData];console.log(e),l(P(e))}else d.b.error((null===o||void 0===o?void 0:o.message)||"Something wrong");return l(w(!1,"posting")),await n}catch(n){l(w(!1,"posting"))}},modalPopup:y})))})),I=a.a.createElement;function A(){return I("div",null,I(v,null,I(T,null)))}},FVaq:function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var o=n("q1tI"),a=n.n(o),r={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M988 548c-19.9 0-36-16.1-36-36 0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 00-94.3-139.9 437.71 437.71 0 00-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.3C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3.1 19.9-16 36-35.9 36z"}}]},name:"loading",theme:"outlined"},c=n("6VBw"),s=function(e,t){return o.createElement(c.a,Object.assign({},e,{ref:t,icon:r}))};s.displayName="LoadingOutlined";var i=o.forwardRef(s),l=a.a.createElement;function m(e){var t=e.loading,n=e.children;return t?l("div",{style:{margin:"2em",textAlign:"center"}},l(i,{style:{fontSize:"2em",color:"#407cff"}})):n}},mDtT:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/timeline",function(){return n("Dx8+")}])},qg42:function(e,t,n){e.exports={timeline:"timeline_timeline__mY-nJ",createPostInput:"timeline_createPostInput__Xrg8W",createPostDiv:"timeline_createPostDiv__1JJhj",mobile_profile_header:"timeline_mobile_profile_header__TFfnT"}},rOC1:function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var o=n("rePB"),a=n("Ff2n"),r=n("q1tI"),c=n.n(r),s=n("9rZX"),i=n.n(s),l=n("4i/N"),m=n("a/fa"),u=n.n(m),d=n("TSYQ"),p=n.n(d),h=c.a.createElement;i.a.setAppElement("#modal_place");var f={content:{},overlay:{backgroundColor:"rgba(50, 50, 50, .8)"}};function g(e){var t=e.children,n=e.showModal,r=e.narrow_container,c=e.title,s=Object(a.a)(e,["children","showModal","narrow_container","title"]);return h(i.a,{isOpen:n,style:f,className:p()(u.a.modal_content,Object(o.a)({},u.a.narrow,r)),shouldCloseOnOverlayClick:!0,onRequestClose:s.onClose},h("div",{className:u.a.header},h("div",{className:u.a.title},h("p",{style:{color:"white"}},c)),h("button",{className:u.a.close,type:"button",onClick:s.onClose},h(l.a,null))),h("div",{className:u.a.content},t))}}},[["mDtT",0,2,5,10,1,3,4,6,7,9,8,11,12]]]);