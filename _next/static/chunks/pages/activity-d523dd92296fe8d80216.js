_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[22],{"07EC":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return U}));var r=n("q1tI"),o=n.n(r),a=n("KQm4"),c=n("rePB"),s=n("o0o1"),i=n.n(s),u=n("HaE+"),p=n("B3wi"),d=(n("Bfm4"),n("A9a1")),l=n("5D7U"),f=n.n(l),m=n("rOC1"),v=n("ffwR"),h=n("uoqP"),_=n("tsqr"),b=n("jL+W"),y=o.a.createElement;function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach((function(t){Object(c.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var w={loading:!1,postingLoading:!1,activityData:[]};function j(e,t){var n=t.type,r=t.payload;switch(n){case"activity/SET_LOADING":return g(g({},e),{},{loading:r});case"activity/SET_POSTING_LOADING":return g(g({},e),{},{postingLoading:r});case"activity/SET_ACTIVITY_DATA":return g(g({},e),{},{activityData:r});default:return e}}var P=Object(r.createContext)([{},function(){}]),k=function(e){var t=e.children,n=Object(r.useReducer)(j,w);return y(P.Provider,{value:n},t)};function x(e){switch(e){case"activity":return"activity/SET_LOADING";case"posting":return"activity/SET_POSTING_LOADING";default:return""}}var D=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"activity";return{type:x(t),payload:e}},S=function(e){return{type:"activity/SET_ACTIVITY_DATA",payload:e}},E=n("PObt"),A=n("FVaq"),C=o.a.createElement;function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach((function(t){Object(c.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var I=Object(b.a)((function(e){var t,n=e.authServices,c=e.auth,s=Object(r.useContext)(P),l=s[0],b=s[1],y=Object(r.useState)(!1),O=y[0],g=y[1],w=Object(r.useState)(!1),j=(w[0],w[1],function(){var e=Object(u.a)(i.a.mark((function e(t){var r,o,a,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(h.b)({method:"post",url:"/accounts/activity",headers:{"x-token":t}});case 3:r=e.sent,o=r.data,200===(a=r.status)?(c=o.map((function(e){return e=k(e)})),b(S(c))):403===a?n.refreshToken(j):_.b.error((null===o||void 0===o?void 0:o.message)||"Something wrong"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()),k=function(e){return"Comment"===e.type?"Post"==e.commented.type?N(N({},e.commented),{},{comments:[N({},e)]}):"Comment"==e.commented.type?N(N({},e.commented.commented),{},{comments:[N(N({},e.commented),{},{comments:[e]})]}):"Share"==e.commented.type?N(N({},e.commented.shared),{},{comments:[N({},e)]}):N(N({},e.commented),{},{comments:[N({},e)]}):"Post"===e.type?e:"Share"===e.type?N(N({},e.shared),{},{shares:[N({},e)]}):e},x=function(){var e=Object(u.a)(i.a.mark((function e(t){var n,r,o,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,b(D(!0,"posting")),e.next=4,Object(h.b)({method:"post",url:"/posts",data:t,headers:{"x-token":c.token}});case 4:return n=e.sent,r=n.data,201===n.status?(g(0),o=N(N({type:"Post"},r),{},{comments:[],commentsCount:0,rating:null,reactions:[],reactionsCount:0,shares:[],sharesCount:0,account:c.user}),s=[o].concat(Object(a.a)(l.activityData)),console.log(s),b(S(s))):_.b.error((null===r||void 0===r?void 0:r.message)||"Something wrong"),b(D(!1,"posting")),e.next=10,n;case 10:return e.abrupt("return",e.sent);case 13:e.prev=13,e.t0=e.catch(0),b(D(!1,"posting"));case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t){return e.apply(this,arguments)}}(),T=function(){var e=Object(u.a)(i.a.mark((function e(t,n,r){var o,a,s,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,b(D(!0,"posting")),o="","Photo"===t?o="/photos/rate":"VideoClip"===t?o="/video-clips/rate":"Item"===t?o="/items/rate":"Post"===t?o="/posts/rate":"Comment"===t&&(o="/comments/rate"),e.next=6,Object(h.b)({method:"post",url:o,data:{id:n,rating:r},headers:{"x-token":c.token}});case 6:return a=e.sent,s=a.data,u=a.status,console.warn("ratePost",s,u),201===u?(l.activityData.map((function(e){if(e.id===n&&e.type===t)return e.rating=r,e})),b(S(l.activityData))):_.b.error((null===s||void 0===s?void 0:s.message)||"Something wrong"),b(D(!1,"posting")),e.next=13,a;case 13:return e.abrupt("return",e.sent);case 16:e.prev=16,e.t0=e.catch(0),b(D(!1,"posting"));case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t,n,r){return e.apply(this,arguments)}}(),I=function(){g(!0)},R=function(){var e=Object(u.a)(i.a.mark((function e(t,n,r){var o,a,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o="","Photo"===t?o="/photos/react":"VideoClip"===t?o="/video-clips/react":"Item"===t?o="/items/react":"Post"===t?o="/posts/react":"Comment"===t?o="/comments/react":"Share"===t&&(o="/shares/react"),e.prev=2,e.next=5,Object(h.b)({method:"post",url:o,data:{reacted:n,reaction:r},headers:{"x-token":c.token}});case 5:if(a=e.sent,s=a.data,201!==a.status){e.next=11;break}_.b.success("Added successfully"),e.next=13;break;case 11:throw _.b.error((null===s||void 0===s?void 0:s.message)||"Something wrong"),new Error;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(2),console.log(e.t0);case 18:case"end":return e.stop()}}),e,null,[[2,15]])})));return function(t,n,r){return e.apply(this,arguments)}}(),U=function(){var e=Object(u.a)(i.a.mark((function e(t,n){var r,o,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="","Photo"===t?r="/photos/share":"VideoClip"===t?r="/video-clips/share":"Item"===t?r="/items/share":"Post"===t?r="/posts/share":"Comment"===t?r="/comments/share":"Share"===t&&(r="/posts/share"),e.prev=2,e.next=5,Object(h.b)({method:"post",url:r,data:{shared:n},headers:{"x-token":c.token}});case 5:if(o=e.sent,a=o.data,201!==o.status){e.next=11;break}_.b.success("Shared successfully"),e.next=13;break;case 11:throw _.b.error((null===a||void 0===a?void 0:a.message)||"Something wrong"),new Error;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(2),console.log(e.t0);case 18:case"end":return e.stop()}}),e,null,[[2,15]])})));return function(t,n){return e.apply(this,arguments)}}(),V=function(){var e=Object(u.a)(i.a.mark((function e(t){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(h.b)({method:"delete",url:"/posts",data:{id:t},headers:{"x-token":c.token}});case 3:n=e.sent,n.data,400!==n.status?(r=l.activityData.filter((function(e){return e.id!==t})),b(S(r)),_.b.success("Deleted successfully!")):_.b.error("This post deleting does not allowed!"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}(),L=function(){var e=Object(u.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log(t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Object(r.useEffect)((function(){j(c.token)}),[]);var G=c.user;return C(o.a.Fragment,null,C(p.a,null),C("div",{className:f.a.feed},C("div",{className:f.a.feed_container},C("div",{className:f.a.createPostDiv},C(v.a,{size:50,url:null===G||void 0===G||null===(t=G.profilePhoto)||void 0===t?void 0:t.src,username:null===G||void 0===G?void 0:G.username}),C("input",{className:f.a.createPostInput,placeholder:"What's on your mind?",onClick:I})),C(A.a,{loading:l.loading},C(E.a,{data:l.activityData,onUpdateTimeline:function(e){l.activityData.map((function(t){if(t.id==e.id){var n=N({account:c.user},e.comments[0]);return"undefined"==typeof t.comments?t.comments=[n]:t.comments.push(n),t.commentsCount+=e.commentsCount,t}})),console.log(l.activityData),b(S(l.activityData))},onRatePost:T,likeAction:R,shareAction:U,deleteAction:V,processedVideoUpdate:L,auth:c})))),C(m.a,{title:"Create Post",showModal:O,onClose:function(){return g(0)}},C(d.a,{loading:l.postingLoading,onPosting:x,modalPopup:I})))})),R=o.a.createElement;function U(){return R("div",null,R(k,null,R(I,null)))}},"5D7U":function(e,t,n){e.exports={feed:"feed_feed__3HJC8",createPostInput:"feed_createPostInput__36HyW",createPostDiv:"feed_createPostDiv__3Zj4X",mobile_profile_header:"feed_mobile_profile_header__2aDWK"}},Bfm4:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n("q1tI"),o=n.n(r),a=n("aZUF"),c=n.n(a),s=n("2/Rp"),i=(n("TSYQ"),n("nOHt")),u=(n("ffwR"),n("PObt")),p=o.a.createElement;function d(e){var t,n=e.user,o=e.onRatePost,a=e.onUpdateTimeline,d=e.processedVideoUpdate,l=e.likeAction,f=e.shareAction,m=e.deleteAction,v=e.auth,h=Object(i.useRouter)(),_=Object(r.useRef)(null),b=Object(r.useState)(null),y=(b[0],b[1],null!==n&&void 0!==n&&"https://freeskies.com/static/".concat(null===(t=n.profilePhoto)||void 0===t?void 0:t.src),null!==n&&void 0!==n?null===n||void 0===n?void 0:n.activity.map((function(e){return e.account=n,e})):[]);return p("div",{className:c.a.activity_content,ref:_},p("div",{className:c.a.section_title},p(s.a,{type:"link",onClick:function(){h.push("/activity")}},"All activities")),0!==y.length&&p(u.a,{data:y,onRatePost:o,onUpdateTimeline:a,processedVideoUpdate:d,likeAction:l,shareAction:f,deleteAction:m,parentDiv:_,auth:v}))}},aZUF:function(e,t,n){e.exports={activity_content:"feed-post_activity_content__3N-h7",section_title:"feed-post_section_title__1we2Z",post:"feed-post_post__bhijE",post_header:"feed-post_post_header__1Sj-6",avatar:"feed-post_avatar__O0xLc",user_info:"feed-post_user_info__29hGR",user_name:"feed-post_user_name__5k8XZ",date:"feed-post_date__2-Vtb",post_content:"feed-post_post_content__2oE53",description:"feed-post_description__10C5X",image:"feed-post_image__3H2wO",post_actions:"feed-post_post_actions__1-APA",posts:"feed-post_posts__3gKRn",comments:"feed-post_comments__2alYi"}},pAKN:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/activity",function(){return n("07EC")}])}},[["pAKN",0,2,4,13,11,1,3,6,5,7,8,10,9,12]]]);