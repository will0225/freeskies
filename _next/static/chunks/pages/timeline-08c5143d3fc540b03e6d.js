_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[26],{"Dx8+":function(e,t,o){"use strict";o.r(t),o.d(t,"default",(function(){return A}));var n=o("q1tI"),r=o.n(n),a=o("rePB"),s=o("B3wi"),i=o("PObt"),c=o("A9a1"),l=o("qg42"),m=o.n(l),u=o("uoqP"),d=o("tsqr"),p=r.a.createElement;function h(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function f(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?h(Object(o),!0).forEach((function(t){Object(a.a)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):h(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var b={loading:!1,postingLoading:!1,timelineData:[]};function g(e,t){var o=t.type,n=t.payload;switch(o){case"timeline/SET_LOADING":return f(f({},e),{},{loading:n});case"timeline/SET_POSTING_LOADING":return f(f({},e),{},{postingLoading:n});case"timeline/SET_TIMELINE_DATA":return f(f({},e),{},{timelineData:n});default:return e}}var y=Object(n.createContext)([{},function(){}]),O=function(e){var t=e.children,o=Object(n.useReducer)(g,b);return p(y.Provider,{value:o},t)};function v(e){switch(e){case"timeline":return"timeline/SET_LOADING";case"posting":return"timeline/SET_POSTING_LOADING";default:return""}}var w=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"timeline";return{type:v(t),payload:e}},P=function(e){return{type:"timeline/SET_TIMELINE_DATA",payload:e}},j=o("FVaq"),k=o("jL+W"),D=o("rOC1"),S=o("ffwR"),E=r.a.createElement;function T(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function I(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?T(Object(o),!0).forEach((function(t){Object(a.a)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):T(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var C=Object(k.a)((function({authServices:e,auth:t}){var o;const{0:a,1:l}=Object(n.useContext)(y),{0:p,1:h}=Object(n.useState)(!1),{0:f,1:b}=Object(n.useState)(!1),g=async(t,o=!1)=>{try{o||l(w(!0));const r=await Object(u.b)({method:"post",url:"/accounts/timeline",headers:{"x-token":t}}),{data:a,status:s}=r;if(200===s){var n=a.map(e=>e=O(e));l(P(n)),console.log("=========")}else 403===s?(console.log("================= Refresh token !"),e.refreshToken(g)):d.b.error((null===a||void 0===a?void 0:a.message)||"Something wrong");o||l(w(!1))}catch(r){console.log(r),o||l(w(!1))}},O=e=>"Comment"===e.type?"Post"==e.commented.type?I(I({},e.commented),{},{comments:[I({},e)]}):"Comment"==e.commented.type?I(I({},e.commented.commented),{},{comments:[I(I({},e.commented),{},{comments:[e]})]}):"Share"==e.commented.type?I(I({},e.commented.shared),{},{comments:[I({},e)]}):I(I({},e.commented),{},{comments:[I({},e)]}):"Post"===e.type?e:"Share"===e.type?I(I({},e.shared),{},{shares:[I({},e)]}):e,v=()=>{h(!0)};Object(n.useEffect)(()=>{g(t.token),window.addEventListener("scroll",_.throttle(()=>{const e=window.pageYOffset;b(e>100)},250))},[]);const{user:k}=t;return E(r.a.Fragment,null,E(s.a,null),E("div",{className:m.a.timeline},E("div",{className:m.a.feed_container},E("div",{className:m.a.createPostDiv},E(S.a,{size:50,url:null===k||void 0===k||null===(o=k.profilePhoto)||void 0===o?void 0:o.src,username:null===k||void 0===k?void 0:k.username}),E("input",{className:m.a.createPostInput,placeholder:"What's on your mind?",onClick:v})),E(j.a,{loading:a.loading},E(i.a,{data:a.timelineData,onUpdateTimeline:e=>{a.timelineData.map(o=>{if(o.id==e.id){let n=I({account:t.user},e.comments[0]);return"undefined"==typeof o.comments?o.comments=[n]:o.comments.push(n),o.commentsCount+=e.commentsCount,o}}),l(P(a.timelineData))},onRatePost:async(e,o,n)=>{try{l(w(!0,"posting"));let r="";"Photo"===e?r="/photos/rate":"VideoClip"===e?r="/video-clips/rate":"Item"===e?r="/items/rate":"Post"===e?r="/posts/rate":"Comment"===e?r="/comments/rate":"MarketplaceItemForSale"===e?r="/marketplace/items-for-sale/rate":"MarketplaceItemToBuy"===e&&(r="/marketplace/items-to-buy/rate");const s=await Object(u.b)({method:"post",url:r,data:{id:o,rating:n},headers:{"x-token":t.token}}),{data:i,status:c}=s;return console.warn("ratePost",i,c),201===c?(a.timelineData.map(t=>{if(t.id===o&&t.type===e)return t.rating=n,t}),l(P(a.timelineData))):d.b.error((null===i||void 0===i?void 0:i.message)||"Something wrong"),l(w(!1,"posting")),await s}catch(r){l(w(!1,"posting"))}},likeAction:async(e,o,n)=>{var r="";"Photo"===e?r="/photos/react":"VideoClip"===e?r="/video-clips/react":"Item"===e?r="/items/react":"Post"===e?r="/posts/react":"Comment"===e?r="/comments/react":"Share"===e?r="/shares/react":"MarketplaceItemForSale"===e?r="/marketplace/items-for-sale/react":"MarketplaceItemToBuy"===e&&(r="/marketplace/items-to-buy/react");try{const e=await Object(u.b)({method:"post",url:r,data:{reacted:o,reaction:n},headers:{"x-token":t.token}}),{data:a,status:s}=e;if(201!==s)throw d.b.error((null===a||void 0===a?void 0:a.message)||"Something wrong"),new Error;d.b.success("Added successfully")}catch(a){console.log(a)}},shareAction:async(e,o)=>{var n="";"Photo"===e?n="/photos/share":"VideoClip"===e?n="/video-clips/share":"Item"===e?n="/items/share":"Post"===e?n="/posts/share":"Comment"===e?n="/comments/share":"Share"===e?n="/posts/share":"MarketplaceItemForSale"===e?n="/marketplace/items-for-sale/share":"MarketplaceItemToBuy"===e&&(n="/marketplace/items-to-buy/share");try{const e=await Object(u.b)({method:"post",url:n,data:{shared:o},headers:{"x-token":t.token}}),{data:r,status:a}=e;if(201!==a)throw d.b.error((null===r||void 0===r?void 0:r.message)||"Something wrong"),new Error;d.b.success("Shared successfully")}catch(r){console.log(r)}},deleteAction:async e=>{try{const n=await Object(u.b)({method:"delete",url:"/posts",data:{id:e},headers:{"x-token":t.token}}),{data:r,status:s}=n;if(400!==s){var o=a.timelineData.filter(t=>t.id!==e);l(P(o)),d.b.success("Deleted successfully!")}else d.b.error("This post deleting does not allowed!")}catch(n){console.log(n)}},auth:t})))),E(D.a,{title:"Create Post",showModal:p,onClose:()=>h(0)},E(c.a,{loading:a.postingLoading,onPosting:async e=>{try{l(w(!0,"posting"));const o=await Object(u.b)({method:"post",url:"/posts",data:e,headers:{"x-token":t.token}}),{data:n,status:r}=o;if(201===r){h(0);let e=[I(I({type:"Post"},n),{},{comments:[],commentsCount:0,rating:null,reactions:[],reactionsCount:0,shares:[],sharesCount:0,account:t.user}),...a.timelineData];console.log(e),l(P(e))}else d.b.error((null===n||void 0===n?void 0:n.message)||"Something wrong");return l(w(!1,"posting")),await o}catch(o){l(w(!1,"posting"))}},modalPopup:v})))})),N=r.a.createElement;function A(){return N("div",null,N(O,null,N(C,null)))}},mDtT:function(e,t,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/timeline",function(){return o("Dx8+")}])},qg42:function(e,t,o){e.exports={timeline:"timeline_timeline__mY-nJ",createPostInput:"timeline_createPostInput__Xrg8W",createPostDiv:"timeline_createPostDiv__1JJhj",mobile_profile_header:"timeline_mobile_profile_header__TFfnT"}}},[["mDtT",0,2,5,10,1,3,4,6,7,8,9,11]]]);