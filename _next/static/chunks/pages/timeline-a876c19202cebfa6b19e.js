_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[24],{B3wi:function(e,t,a){"use strict";var n=a("rePB"),o=a("q1tI"),r=a.n(o),i=a("Tyw5"),c=a.n(i),s=a("nOHt"),l=a("TSYQ"),u=a.n(l),d=a("LvDl"),m=a.n(d),h=a("/MKj"),p=a("ffwR"),f=r.a.createElement;function v(e){var t=e.user,a=void 0===t?{}:t,n=Object(s.useRouter)();return f("div",{className:c.a.profile,onClick:function(){n.push("/profile")}},f("div",{className:c.a.avatar},(null===a||void 0===a?void 0:a.profilePhoto)?f(p.a,{size:40,url:null===a||void 0===a?void 0:a.profilePhoto.src,text:null===a||void 0===a?void 0:a.username}):f(p.a,{size:40,text:null===a||void 0===a?void 0:a.firstName})),f("span",{className:c.a.name},"".concat(null===a||void 0===a?void 0:a.firstName)))}t.a=Object(h.b)((function(e){return{user:e.auth.user}}))((function(e){var t=e.withoutSearch,a=e.user,i=Object(o.useState)(0),s=i[0],l=(i[1],Object(o.useState)(!0)),d=l[0],h=l[1],p=null,g=function(){try{window.pageYOffset;p&&clearTimeout(p),p=setTimeout((function(){p=null,h(!0)}),500),d&&h(!1)}catch(e){console.log(e)}};return Object(o.useEffect)((function(){try{window.addEventListener("scroll",m.a.throttle(g,250))}catch(e){console.log(e)}return function(){try{window.removeEventListener("scroll",g)}catch(e){console.log(e)}}}),[s]),f(r.a.Fragment,null,f("div",{className:u()(c.a.header,Object(n.a)({},c.a.header_hidden,!d))},f("div",{className:c.a.container},f("div",{className:c.a.logo},f("img",{src:"/logo.png",alt:"logo"})),f("div",{className:c.a.search},!t&&f(r.a.Fragment,null,f("input",{name:"search",placeholder:"Search ..."}),f(v,null))),f(v,{user:a}))),f("div",{className:c.a.additional_header}))}))},"Dx8+":function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return x}));var n=a("q1tI"),o=a.n(n),r=a("rePB"),i=a("B3wi"),c=a("PObt"),s=a("A9a1"),l=a("qg42"),u=a.n(l),d=a("uoqP"),m=a("tsqr"),h=o.a.createElement;function p(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function f(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?p(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var v={loading:!1,postingLoading:!1,timelineData:[]};function g(e,t){var a=t.type,n=t.payload;switch(a){case"timeline/SET_LOADING":return f(f({},e),{},{loading:n});case"timeline/SET_POSTING_LOADING":return f(f({},e),{},{postingLoading:n});case"timeline/SET_TIMELINE_DATA":return f(f({},e),{},{timelineData:n});default:return e}}var b=Object(n.createContext)([{},function(){}]),O=function(e){var t=e.children,a=Object(n.useReducer)(g,v);return h(b.Provider,{value:a},t)};function w(e){switch(e){case"timeline":return"timeline/SET_LOADING";case"posting":return"timeline/SET_POSTING_LOADING";default:return""}}var y=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"timeline";return{type:w(t),payload:e}},P=function(e){return{type:"timeline/SET_TIMELINE_DATA",payload:e}},j=a("FVaq"),N=a("jL+W"),E=a("rOC1"),D=a("ffwR"),S=o.a.createElement;function C(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function T(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?C(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):C(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var k=Object(N.a)((function({authServices:e,auth:t}){var a,r;const{0:l,1:h}=Object(n.useContext)(b),{0:p,1:f}=Object(n.useState)(!1),{0:v,1:g}=Object(n.useState)(!1),O=async(t,a=!1)=>{try{a||h(y(!0));const o=await Object(d.a)({method:"post",url:"/accounts/timeline",headers:{"x-token":t}}),{data:r,status:i}=o;if(200===i){var n=r.map(e=>e=w(e));h(P(n)),console.log("=========")}else 403===i?(console.log("================= Refresh token !"),e.refreshToken(O)):m.b.error((null===r||void 0===r?void 0:r.message)||"Something wrong");a||h(y(!1))}catch(o){console.log(o),a||h(y(!1))}},w=e=>"Comment"===e.type?"Post"==e.commented.type?T(T({},e.commented),{},{comments:[T(T({},e),{},{account:e.commented.account})]}):"Comment"==e.commented.type?T(T({},e.commented.commented),{},{comments:[T(T({},e.commented),{},{comments:[e],account:e.commented.commented.account})]}):"Share"==e.commented.type?T(T({},e.commented.shared),{},{comments:[T(T({},e),{},{account:e.commented.shared.account})]}):T(T({},e.commented),{},{comments:[T(T({},e),{},{account:e.commented.account})]}):"Post"===e.type?e:"Share"===e.type?T(T({},e.shared),{},{comments:[T(T({},e),{},{account:e.shared.account})]}):e,N=()=>{f(!0)};Object(n.useEffect)(()=>{O(t.token),window.addEventListener("scroll",_.throttle(()=>{const e=window.pageYOffset;g(e>100)},250))},[]);const{user:C}=t;return S(o.a.Fragment,null,S(i.a,null),v?S("div",{className:u.a.mobile_profile_header},S("div",{className:u.a.avatar},S("div",{className:u.a.avatar_image},S(D.a,{size:40,url:null===C||void 0===C||null===(a=C.profilePhoto)||void 0===a?void 0:a.src,text:null===C||void 0===C?void 0:C.username}))),S("p",{className:u.a.mobile_fullname,style:{cursor:"pointer"}},S("span",null,"".concat(null===C||void 0===C?void 0:C.firstName," ").concat(null===C||void 0===C?void 0:C.lastName)))):null,S("div",{className:u.a.timeline},S("div",{className:u.a.feed_container},S("div",{className:u.a.createPostDiv},S(D.a,{size:50,url:null===C||void 0===C||null===(r=C.profilePhoto)||void 0===r?void 0:r.src}),S("input",{className:u.a.createPostInput,placeholder:"What's on your mind?",onClick:N})),S(j.a,{loading:l.loading},S(c.a,{data:l.timelineData,onUpdateTimeline:e=>{l.timelineData.map(a=>{if(a.id==e.id){let n=T({account:t.user},e.comments[0]);return a.comments.push(n),a.commentsCount+=e.commentsCount,a}}),console.log(l.timelineData),h(P(l.timelineData))},onRatePost:async(e,a,n)=>{try{h(y(!0,"posting"));let o="";"Photo"===e?o="/photos/rate":"VideoClip"===e?o="/video-clips/rate":"Item"===e?o="/items/rate":"Post"===e?o="/posts/rate":"Comment"===e&&(o="/comments/rate");const r=await Object(d.a)({method:"post",url:o,data:{rated:a,rating:n},headers:{"x-token":t.token}}),{data:i,status:c}=r;return console.warn("ratePost",i,c),201===c?(l.timelineData.map(t=>{if(t.id===a&&t.type===e)return t.rating=n,t}),h(P(l.timelineData))):m.b.error((null===i||void 0===i?void 0:i.message)||"Something wrong"),h(y(!1,"posting")),await r}catch(o){h(y(!1,"posting"))}},likeAction:async(e,a,n)=>{var o="";"Photo"===e?o="/photos/react":"VideoClip"===e?o="/video-clips/react":"Item"===e?o="/items/react":"Post"===e?o="/posts/react":"Comment"===e?o="/comments/react":"Share"===e&&(o="/shares/react");try{const e=await Object(d.a)({method:"post",url:o,data:{reacted:a,reaction:n},headers:{"x-token":t.token}}),{data:r,status:i}=e;if(201!==i)throw m.b.error((null===r||void 0===r?void 0:r.message)||"Something wrong"),new Error;m.b.success("Evaluate successfully")}catch(r){console.log(r)}},shareAction:async(e,a)=>{var n="";"Photo"===e?n="/photos/share":"VideoClip"===e?n="/video-clips/share":"Item"===e?n="/items/share":"Post"===e?n="/posts/share":"Comment"===e?n="/comments/share":"Share"===e&&(n="/posts/share");try{const e=await Object(d.a)({method:"post",url:n,data:{shared:a},headers:{"x-token":t.token}}),{data:o,status:r}=e;if(201!==r)throw m.b.error((null===o||void 0===o?void 0:o.message)||"Something wrong"),new Error;m.b.success("Evaluate successfully")}catch(o){console.log(o)}}})))),S(E.a,{title:"Create Post",showModal:p,onClose:()=>f(0)},S(s.a,{loading:l.postingLoading,onPosting:async e=>{try{h(y(!0,"posting"));const a=await Object(d.a)({method:"post",url:"/posts",data:e,headers:{"x-token":t.token}}),{data:n,status:o}=a;if(201===o){f(0);let e=[T(T({type:"Post"},n),{},{comments:[],commentsCount:0,rating:null,reactions:[],reactionsCount:0,shares:[],sharesCount:0,account:t.user}),...l.timelineData];console.log(e),h(P(e))}else m.b.error((null===n||void 0===n?void 0:n.message)||"Something wrong");return h(y(!1,"posting")),await a}catch(a){h(y(!1,"posting"))}},modalPopup:N})))})),I=o.a.createElement;function x(){return I("div",null,I(O,null,I(k,null)))}},FVaq:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a("q1tI"),o=a.n(n),r={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M988 548c-19.9 0-36-16.1-36-36 0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 00-94.3-139.9 437.71 437.71 0 00-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.3C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3.1 19.9-16 36-35.9 36z"}}]},name:"loading",theme:"outlined"},i=a("6VBw"),c=function(e,t){return n.createElement(i.a,Object.assign({},e,{ref:t,icon:r}))};c.displayName="LoadingOutlined";var s=n.forwardRef(c),l=o.a.createElement;function u(e){var t=e.loading,a=e.children;return t?l("div",{style:{margin:"2em",textAlign:"center"}},l(s,{style:{fontSize:"2em",color:"#407cff"}})):a}},Tyw5:function(e,t,a){e.exports={additional_header:"header_additional_header__Wyu42",header:"header_header__ecC39",header_hidden:"header_header_hidden__2Q2DD",container:"header_container__bXWQQ",logo:"header_logo__2MPw_",search:"header_search__sw4Be",profile:"header_profile__1JSwu",name:"header_name__3HhTm",avatar:"header_avatar__boSZH"}},mDtT:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/timeline",function(){return a("Dx8+")}])},qg42:function(e,t,a){e.exports={timeline:"timeline_timeline__mY-nJ",createPostInput:"timeline_createPostInput__Xrg8W",createPostDiv:"timeline_createPostDiv__1JJhj",mobile_profile_header:"timeline_mobile_profile_header__TFfnT"}},rOC1:function(e,t,a){"use strict";a.d(t,"a",(function(){return v}));var n=a("rePB"),o=a("Ff2n"),r=a("q1tI"),i=a.n(r),c=a("9rZX"),s=a.n(c),l=a("4i/N"),u=a("a/fa"),d=a.n(u),m=a("TSYQ"),h=a.n(m),p=i.a.createElement;s.a.setAppElement("#modal_place");var f={content:{},overlay:{backgroundColor:"rgba(50, 50, 50, .8)"}};function v(e){var t=e.children,a=e.showModal,r=e.narrow_container,i=e.title,c=Object(o.a)(e,["children","showModal","narrow_container","title"]);return p(s.a,{isOpen:a,style:f,className:h()(d.a.modal_content,Object(n.a)({},d.a.narrow,r)),shouldCloseOnOverlayClick:!0,onRequestClose:c.onClose},p("div",{className:d.a.header},p("div",{className:d.a.title},p("p",{style:{color:"white"}},i)),p("button",{className:d.a.close,type:"button",onClick:c.onClose},p(l.a,null))),p("div",{className:d.a.content},t))}}},[["mDtT",0,2,5,10,1,3,4,6,8,7,9,11]]]);