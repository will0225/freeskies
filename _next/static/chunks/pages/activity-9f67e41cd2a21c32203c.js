_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[19],{"07EC":function(t,e,o){"use strict";o.r(e),o.d(e,"default",(function(){return N}));var a=o("q1tI"),n=o.n(a),s=o("rePB"),r=o("B3wi"),c=(o("Bfm4"),o("A9a1")),i=o("5D7U"),d=o.n(i),l=o("rOC1"),u=o("ffwR"),p=o("uoqP"),m=o("tsqr"),_=o("jL+W"),f=n.a.createElement;function h(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,a)}return o}function v(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?h(Object(o),!0).forEach((function(e){Object(s.a)(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):h(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}const y={loading:!1,postingLoading:!1,activityData:[]};function b(t,{type:e,payload:o}){switch(e){case"activity/SET_LOADING":return v(v({},t),{},{loading:o});case"activity/SET_POSTING_LOADING":return v(v({},t),{},{postingLoading:o});case"activity/SET_ACTIVITY_DATA":return v(v({},t),{},{activityData:o});default:return t}}const O=Object(a.createContext)([{},()=>{}]),g=({children:t})=>{const e=Object(a.useReducer)(b,y);return f(O.Provider,{value:e},t)};function P(t){switch(t){case"activity":return"activity/SET_LOADING";case"posting":return"activity/SET_POSTING_LOADING";default:return""}}var w=(t,e="activity")=>({type:P(e),payload:t});var j=t=>({type:"activity/SET_ACTIVITY_DATA",payload:t}),D=o("PObt"),S=o("FVaq"),A=n.a.createElement;function C(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,a)}return o}function E(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?C(Object(o),!0).forEach((function(e){Object(s.a)(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):C(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}var k=Object(_.a)((function({authServices:t,auth:e}){var o;const{0:s,1:i}=Object(a.useContext)(O),{0:_,1:f}=Object(a.useState)(!1),{0:h,1:v}=Object(a.useState)(!1),y=async e=>{try{const a=await Object(p.b)({method:"post",url:"/accounts/activity",headers:{"x-token":e}}),{data:n,status:s}=a;if(200===s){var o=n.map(t=>t=b(t));i(j(o))}else 403===s?t.refreshToken(y):m.b.error((null===n||void 0===n?void 0:n.message)||"Something wrong")}catch(a){console.log(a)}},b=t=>"Comment"===t.type?"Post"==t.commented.type?E(E({},t.commented),{},{comments:[E({},t)]}):"Comment"==t.commented.type?E(E({},t.commented.commented),{},{comments:[E(E({},t.commented),{},{comments:[t]})]}):"Share"==t.commented.type?E(E({},t.commented.shared),{},{comments:[E({},t)]}):E(E({},t.commented),{},{comments:[E({},t)]}):"Post"===t.type?t:"Share"===t.type?E(E({},t.shared),{},{shares:[E({},t)]}):t,g=()=>{f(!0)};Object(a.useEffect)(()=>{y(e.token)},[]);const{user:P}=e;return A(n.a.Fragment,null,A(r.a,null),A("div",{className:d.a.feed},A("div",{className:d.a.feed_container},A("div",{className:d.a.createPostDiv},A(u.a,{size:50,url:null===P||void 0===P||null===(o=P.profilePhoto)||void 0===o?void 0:o.src,username:null===P||void 0===P?void 0:P.username}),A("input",{className:d.a.createPostInput,placeholder:"What's on your mind?",onClick:g})),A(S.a,{loading:s.loading},A(D.a,{data:s.activityData,onUpdateTimeline:t=>{s.activityData.map(o=>{if(o.id==t.id){let a=E({account:e.user},t.comments[0]);return"undefined"==typeof o.comments?o.comments=[a]:o.comments.push(a),o.commentsCount+=t.commentsCount,o}}),console.log(s.activityData),i(j(s.activityData))},onRatePost:async(t,o,a)=>{try{i(w(!0,"posting"));let n="";"Photo"===t?n="/photos/rate":"VideoClip"===t?n="/video-clips/rate":"Item"===t?n="/items/rate":"Post"===t?n="/posts/rate":"Comment"===t&&(n="/comments/rate");const r=await Object(p.b)({method:"post",url:n,data:{id:o,rating:a},headers:{"x-token":e.token}}),{data:c,status:d}=r;return console.warn("ratePost",c,d),201===d?(s.activityData.map(e=>{if(e.id===o&&e.type===t)return e.rating=a,e}),i(j(s.activityData))):m.b.error((null===c||void 0===c?void 0:c.message)||"Something wrong"),i(w(!1,"posting")),await r}catch(n){i(w(!1,"posting"))}},likeAction:async(t,o,a)=>{var n="";"Photo"===t?n="/photos/react":"VideoClip"===t?n="/video-clips/react":"Item"===t?n="/items/react":"Post"===t?n="/posts/react":"Comment"===t?n="/comments/react":"Share"===t&&(n="/shares/react");try{const t=await Object(p.b)({method:"post",url:n,data:{reacted:o,reaction:a},headers:{"x-token":e.token}}),{data:s,status:r}=t;if(201!==r)throw m.b.error((null===s||void 0===s?void 0:s.message)||"Something wrong"),new Error;m.b.success("Added successfully")}catch(s){console.log(s)}},shareAction:async(t,o)=>{var a="";"Photo"===t?a="/photos/share":"VideoClip"===t?a="/video-clips/share":"Item"===t?a="/items/share":"Post"===t?a="/posts/share":"Comment"===t?a="/comments/share":"Share"===t&&(a="/posts/share");try{const t=await Object(p.b)({method:"post",url:a,data:{shared:o},headers:{"x-token":e.token}}),{data:n,status:s}=t;if(201!==s)throw m.b.error((null===n||void 0===n?void 0:n.message)||"Something wrong"),new Error;m.b.success("Shared successfully")}catch(n){console.log(n)}},deleteAction:async t=>{try{const a=await Object(p.b)({method:"delete",url:"/posts",data:{id:t},headers:{"x-token":e.token}}),{data:n,status:r}=a;if(400!==r){var o=s.activityData.filter(e=>e.id!==t);i(j(o)),m.b.success("Deleted successfully!")}else m.b.error("This post deleting does not allowed!")}catch(a){console.log(a)}},auth:e})))),A(l.a,{title:"Create Post",showModal:_,onClose:()=>f(0)},A(c.a,{loading:s.postingLoading,onPosting:async t=>{try{i(w(!0,"posting"));const o=await Object(p.b)({method:"post",url:"/posts",data:t,headers:{"x-token":e.token}}),{data:a,status:n}=o;if(201===n){f(0);let t=[E(E({type:"Post"},a),{},{comments:[],commentsCount:0,rating:null,reactions:[],reactionsCount:0,shares:[],sharesCount:0,account:e.user}),...s.activityData];console.log(t),i(j(t))}else m.b.error((null===a||void 0===a?void 0:a.message)||"Something wrong");return i(w(!1,"posting")),await o}catch(o){i(w(!1,"posting"))}},modalPopup:g})))})),T=n.a.createElement;function N(){return T("div",null,T(g,null,T(k,null)))}},"5D7U":function(t,e,o){t.exports={feed:"feed_feed__3HJC8",createPostInput:"feed_createPostInput__36HyW",createPostDiv:"feed_createPostDiv__3Zj4X",mobile_profile_header:"feed_mobile_profile_header__2aDWK"}},Bfm4:function(t,e,o){"use strict";o.d(e,"a",(function(){return u}));var a=o("q1tI"),n=o.n(a),s=o("aZUF"),r=o.n(s),c=o("2/Rp"),i=(o("TSYQ"),o("nOHt")),d=(o("ffwR"),o("PObt")),l=n.a.createElement;function u({user:t,onRatePost:e,onUpdateTimeline:o,likeAction:n,shareAction:s,deleteAction:u,auth:p}){var m;const _=Object(i.useRouter)(),f=Object(a.useRef)(null),{0:h,1:v}=Object(a.useState)(null),y=(null!==t&&void 0!==t&&"https://freeskies.com/static/".concat(null===(m=t.profilePhoto)||void 0===m?void 0:m.src),null!==t&&void 0!==t?null===t||void 0===t?void 0:t.activity.map(e=>(e.account=t,e)):[]);return l("div",{className:r.a.activity_content,ref:f},l("div",{className:r.a.section_title},l(c.a,{type:"link",onClick:()=>{_.push("/activity")}},"All activities")),0!==y.length&&l(d.a,{data:y,onRatePost:e,onUpdateTimeline:o,likeAction:n,shareAction:s,deleteAction:u,parentDiv:f,auth:p}))}},aZUF:function(t,e,o){t.exports={activity_content:"feed-post_activity_content__3N-h7",section_title:"feed-post_section_title__1we2Z",post:"feed-post_post__bhijE",post_header:"feed-post_post_header__1Sj-6",avatar:"feed-post_avatar__O0xLc",user_info:"feed-post_user_info__29hGR",user_name:"feed-post_user_name__5k8XZ",date:"feed-post_date__2-Vtb",post_content:"feed-post_post_content__2oE53",description:"feed-post_description__10C5X",image:"feed-post_image__3H2wO",post_actions:"feed-post_post_actions__1-APA",posts:"feed-post_posts__3gKRn",comments:"feed-post_comments__2alYi"}},pAKN:function(t,e,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/activity",function(){return o("07EC")}])}},[["pAKN",0,2,5,10,1,3,4,6,7,8,9,11]]]);