_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[21],{"07EC":function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return L}));var r=n("q1tI"),o=n.n(r),a=n("KQm4"),c=n("rePB"),s=n("o0o1"),i=n.n(s),u=n("HaE+"),p=n("B3wi"),l=(n("Bfm4"),n("A9a1")),d=n("5D7U"),f=n.n(d),m=n("rOC1"),v=n("ffwR"),h=n("uoqP"),_=n("tsqr"),b=n("jL+W"),y=o.a.createElement;function O(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function g(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?O(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var w={loading:!1,postingLoading:!1,activityData:[]};function j(t,e){var n=e.type,r=e.payload;switch(n){case"activity/SET_LOADING":return g(g({},t),{},{loading:r});case"activity/SET_POSTING_LOADING":return g(g({},t),{},{postingLoading:r});case"activity/SET_ACTIVITY_DATA":return g(g({},t),{},{activityData:r});default:return t}}var P=Object(r.createContext)([{},function(){}]),k=function(t){var e=t.children,n=Object(r.useReducer)(j,w);return y(P.Provider,{value:n},e)};function x(t){switch(t){case"activity":return"activity/SET_LOADING";case"posting":return"activity/SET_POSTING_LOADING";default:return""}}var D=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"activity";return{type:x(e),payload:t}},S=function(t){return{type:"activity/SET_ACTIVITY_DATA",payload:t}},E=n("PObt"),A=n("FVaq"),C=o.a.createElement;function T(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function N(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?T(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var I=Object(b.a)((function(t){var e,n=t.authServices,c=t.auth,s=Object(r.useContext)(P),d=s[0],b=s[1],y=Object(r.useState)(!1),O=y[0],g=y[1],w=Object(r.useState)(!1),j=(w[0],w[1],function(){var t=Object(u.a)(i.a.mark((function t(e){var r,o,a,c;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(h.b)({method:"post",url:"/accounts/activity",headers:{"x-token":e}});case 3:r=t.sent,o=r.data,200===(a=r.status)?(c=o.map((function(t){return t=k(t)})),b(S(c))):403===a?n.refreshToken(j):_.b.error((null===o||void 0===o?void 0:o.message)||"Something wrong"),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.log(t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(e){return t.apply(this,arguments)}}()),k=function(t){return"Comment"===t.type?"Post"==t.commented.type?N(N({},t.commented),{},{comments:[N({},t)]}):"Comment"==t.commented.type?N(N({},t.commented.commented),{},{comments:[N(N({},t.commented),{},{comments:[t]})]}):"Share"==t.commented.type?N(N({},t.commented.shared),{},{comments:[N({},t)]}):N(N({},t.commented),{},{comments:[N({},t)]}):"Post"===t.type?t:"Share"===t.type?N(N({},t.shared),{},{shares:[N({},t)]}):t},x=function(){var t=Object(u.a)(i.a.mark((function t(e){var n,r,o,s;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,b(D(!0,"posting")),t.next=4,Object(h.b)({method:"post",url:"/posts",data:e,headers:{"x-token":c.token}});case 4:return n=t.sent,r=n.data,201===n.status?(g(0),o=N(N({type:"Post"},r),{},{comments:[],commentsCount:0,rating:null,reactions:[],reactionsCount:0,shares:[],sharesCount:0,account:c.user}),s=[o].concat(Object(a.a)(d.activityData)),console.log(s),b(S(s))):_.b.error((null===r||void 0===r?void 0:r.message)||"Something wrong"),b(D(!1,"posting")),t.next=10,n;case 10:return t.abrupt("return",t.sent);case 13:t.prev=13,t.t0=t.catch(0),b(D(!1,"posting"));case 16:case"end":return t.stop()}}),t,null,[[0,13]])})));return function(e){return t.apply(this,arguments)}}(),T=function(){var t=Object(u.a)(i.a.mark((function t(e,n,r){var o,a,s,u;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,b(D(!0,"posting")),o="","Photo"===e?o="/photos/rate":"VideoClip"===e?o="/video-clips/rate":"Item"===e?o="/items/rate":"Post"===e?o="/posts/rate":"Comment"===e&&(o="/comments/rate"),t.next=6,Object(h.b)({method:"post",url:o,data:{id:n,rating:r},headers:{"x-token":c.token}});case 6:return a=t.sent,s=a.data,u=a.status,console.warn("ratePost",s,u),201===u?(d.activityData.map((function(t){if(t.id===n&&t.type===e)return t.rating=r,t})),b(S(d.activityData))):_.b.error((null===s||void 0===s?void 0:s.message)||"Something wrong"),b(D(!1,"posting")),t.next=13,a;case 13:return t.abrupt("return",t.sent);case 16:t.prev=16,t.t0=t.catch(0),b(D(!1,"posting"));case 19:case"end":return t.stop()}}),t,null,[[0,16]])})));return function(e,n,r){return t.apply(this,arguments)}}(),I=function(){g(!0)},R=function(){var t=Object(u.a)(i.a.mark((function t(e,n,r){var o,a,s;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o="","Photo"===e?o="/photos/react":"VideoClip"===e?o="/video-clips/react":"Item"===e?o="/items/react":"Post"===e?o="/posts/react":"Comment"===e?o="/comments/react":"Share"===e&&(o="/shares/react"),t.prev=2,t.next=5,Object(h.b)({method:"post",url:o,data:{reacted:n,reaction:r},headers:{"x-token":c.token}});case 5:if(a=t.sent,s=a.data,201!==a.status){t.next=11;break}_.b.success("Added successfully"),t.next=13;break;case 11:throw _.b.error((null===s||void 0===s?void 0:s.message)||"Something wrong"),new Error;case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(2),console.log(t.t0);case 18:case"end":return t.stop()}}),t,null,[[2,15]])})));return function(e,n,r){return t.apply(this,arguments)}}(),L=function(){var t=Object(u.a)(i.a.mark((function t(e,n){var r,o,a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r="","Photo"===e?r="/photos/share":"VideoClip"===e?r="/video-clips/share":"Item"===e?r="/items/share":"Post"===e?r="/posts/share":"Comment"===e?r="/comments/share":"Share"===e&&(r="/posts/share"),t.prev=2,t.next=5,Object(h.b)({method:"post",url:r,data:{shared:n},headers:{"x-token":c.token}});case 5:if(o=t.sent,a=o.data,201!==o.status){t.next=11;break}_.b.success("Shared successfully"),t.next=13;break;case 11:throw _.b.error((null===a||void 0===a?void 0:a.message)||"Something wrong"),new Error;case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(2),console.log(t.t0);case 18:case"end":return t.stop()}}),t,null,[[2,15]])})));return function(e,n){return t.apply(this,arguments)}}(),G=function(){var t=Object(u.a)(i.a.mark((function t(e){var n,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(h.b)({method:"delete",url:"/posts",data:{id:e},headers:{"x-token":c.token}});case 3:n=t.sent,n.data,400!==n.status?(r=d.activityData.filter((function(t){return t.id!==e})),b(S(r)),_.b.success("Deleted successfully!")):_.b.error("This post deleting does not allowed!"),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.log(t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(e){return t.apply(this,arguments)}}();Object(r.useEffect)((function(){j(c.token)}),[]);var U=c.user;return C(o.a.Fragment,null,C(p.a,null),C("div",{className:f.a.feed},C("div",{className:f.a.feed_container},C("div",{className:f.a.createPostDiv},C(v.a,{size:50,url:null===U||void 0===U||null===(e=U.profilePhoto)||void 0===e?void 0:e.src,username:null===U||void 0===U?void 0:U.username}),C("input",{className:f.a.createPostInput,placeholder:"What's on your mind?",onClick:I})),C(A.a,{loading:d.loading},C(E.a,{data:d.activityData,onUpdateTimeline:function(t){d.activityData.map((function(e){if(e.id==t.id){var n=N({account:c.user},t.comments[0]);return"undefined"==typeof e.comments?e.comments=[n]:e.comments.push(n),e.commentsCount+=t.commentsCount,e}})),console.log(d.activityData),b(S(d.activityData))},onRatePost:T,likeAction:R,shareAction:L,deleteAction:G,auth:c})))),C(m.a,{title:"Create Post",showModal:O,onClose:function(){return g(0)}},C(l.a,{loading:d.postingLoading,onPosting:x,modalPopup:I})))})),R=o.a.createElement;function L(){return R("div",null,R(k,null,R(I,null)))}},"5D7U":function(t,e,n){t.exports={feed:"feed_feed__3HJC8",createPostInput:"feed_createPostInput__36HyW",createPostDiv:"feed_createPostDiv__3Zj4X",mobile_profile_header:"feed_mobile_profile_header__2aDWK"}},Bfm4:function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var r=n("q1tI"),o=n.n(r),a=n("aZUF"),c=n.n(a),s=n("2/Rp"),i=(n("TSYQ"),n("nOHt")),u=(n("ffwR"),n("PObt")),p=o.a.createElement;function l(t){var e,n=t.user,o=t.onRatePost,a=t.onUpdateTimeline,l=t.likeAction,d=t.shareAction,f=t.deleteAction,m=t.auth,v=Object(i.useRouter)(),h=Object(r.useRef)(null),_=Object(r.useState)(null),b=(_[0],_[1],null!==n&&void 0!==n&&"https://freeskies.com/static/".concat(null===(e=n.profilePhoto)||void 0===e?void 0:e.src),null!==n&&void 0!==n?null===n||void 0===n?void 0:n.activity.map((function(t){return t.account=n,t})):[]);return p("div",{className:c.a.activity_content,ref:h},p("div",{className:c.a.section_title},p(s.a,{type:"link",onClick:function(){v.push("/activity")}},"All activities")),0!==b.length&&p(u.a,{data:b,onRatePost:o,onUpdateTimeline:a,likeAction:l,shareAction:d,deleteAction:f,parentDiv:h,auth:m}))}},aZUF:function(t,e,n){t.exports={activity_content:"feed-post_activity_content__3N-h7",section_title:"feed-post_section_title__1we2Z",post:"feed-post_post__bhijE",post_header:"feed-post_post_header__1Sj-6",avatar:"feed-post_avatar__O0xLc",user_info:"feed-post_user_info__29hGR",user_name:"feed-post_user_name__5k8XZ",date:"feed-post_date__2-Vtb",post_content:"feed-post_post_content__2oE53",description:"feed-post_description__10C5X",image:"feed-post_image__3H2wO",post_actions:"feed-post_post_actions__1-APA",posts:"feed-post_posts__3gKRn",comments:"feed-post_comments__2alYi"}},pAKN:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/activity",function(){return n("07EC")}])}},[["pAKN",0,2,5,11,1,3,4,6,7,8,10,9,12]]]);